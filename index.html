<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mon Carnet de Seconde Vie</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    :root {
      --bg: #ffffff;
      --text: #1a1a1a;
      --accent: #d97706;
      --primary: #111827;
      --border: #e5e7eb;
      --success: #16a34a;
    }
    [data-theme="dark"] {
      --bg: #111827;
      --text: #f9fafb;
      --border: #374151;
    }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      border-bottom: 1px solid var(--border);
    }
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 260px;
      height: 100%;
      background: var(--bg);
      border-right: 1px solid var(--border);
      padding: 2rem 1rem;
      overflow-y: auto;
    }
    #sidebar h3 {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: var(--accent);
    }
    #sidebar button {
      width: 100%;
      text-align: left;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      background: transparent;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.2s;
    }
    #sidebar button:hover {
      background: var(--border);
    }
    #sidebar button.done {
      background: var(--success);
      color: white;
    }
    main {
      margin-left: 280px;
      padding: 2rem;
      max-width: 700px;
    }
    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    textarea {
      width: 100%;
      padding: 1rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      resize: vertical;
      min-height: 120px;
    }
    .btn {
      margin-top: 1rem;
      padding: 0.75rem 1.5rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .progress-bar {
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 2rem;
    }
    .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.3s;
    }
    @media (max-width: 768px) {
      #sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s;
      }
      #sidebar.open {
        transform: translateX(0);
      }
      main {
        margin-left: 0;
        padding: 1rem;
      }
    }
  </style>
</head>
<body>

<header>
  <button onclick="toggleSidebar()">â˜°</button>
  <h1>Mon Carnet de Seconde Vie</h1>
  <button onclick="toggleTheme()">ðŸŒ—</button>
</header>

<aside id="sidebar">
  <h3>Progression</h3>
  <div class="progress-bar">
    <div class="progress-fill" id="progress"></div>
  </div>
  <nav id="nav"></nav>
</aside>

<main id="content"></main>

<footer>
  <button class="btn" onclick="downloadLog()">ðŸ“¥ TÃ©lÃ©charger mon carnet</button>
</footer>

<script>
  const chapters = [
    {
      title: "Chapitre 1 â€“ Le Grand Vide ou le Champ des Possibles ?",
      exercise: `
        <h2>Journal de bord â€“ Cartographier le point de dÃ©part</h2>
        <label>1. Ma mÃ©tÃ©o intÃ©rieure aujourdâ€™hui :</label>
        <textarea data-key="c1-meteo" placeholder="Ex. : Je me sens vide, mais curieux..."></textarea>

        <label>2. Ce qui mâ€™a manquÃ© de mon ancienne vie :</label>
        <textarea data-key="c1-manque" placeholder="Ex. : Les collÃ¨gues, le rythme, les objectifs..."></textarea>

        <label>3. Ce qui ne mâ€™a pas manquÃ© :</label>
        <textarea data-key="c1-pas-manque" placeholder="Ex. : Les rÃ©unions interminables..."></textarea>
      `
    },
    {
      title: "Chapitre 2 â€“ Dire au revoir pour mieux se retrouver",
      exercise: `
        <h2>Lettre de transition</h2>
        <label>1. Gratitude :</label>
        <textarea data-key="c2-gratitude" placeholder="Merci pour..."></textarea>

        <label>2. Griefs & regrets :</label>
        <textarea data-key="c2-griefs" placeholder="Je regrette..."></textarea>

        <label>3. Lâ€™adieu :</label>
        <textarea data-key="c2-adieu" placeholder="Je te laisse maintenant..."></textarea>
      `
    },
    {
      title: "Chapitre 3 â€“ Les Cartes RoutiÃ¨res de notre Esprit",
      exercise: `
        <h2>Architecte de tes croyances</h2>
        <label>Croyance limitante :</label>
        <textarea data-key="c3-limitante" placeholder="Ex. : Je ne suis utile que si je produis..."></textarea>

        <label>Nouvelle croyance aidante :</label>
        <textarea data-key="c3-nouvelle" placeholder="Ex. : Ma valeur est dans qui je suis..."></textarea>
      `
    },
    {
      title: "Chapitre 4 â€“ Lâ€™Art de Vivre, Ici et Maintenant",
      exercise: `
        <h2>Ancre de pleine conscience</h2>
        <label>ActivitÃ© choisie (cafÃ©, douche, marche...) :</label>
        <input type="text" data-key="c4-activite" placeholder="Ex. : Boire mon cafÃ©" />

        <label>Ce que jâ€™ai ressenti en y apportant toute mon attention :</label>
        <textarea data-key="c4-sensation" placeholder="Ex. : Jâ€™ai senti la chaleur, lâ€™arÃ´me, le goÃ»t..."></textarea>
      `
    },
    {
      title: "Chapitre 5 â€“ Ã€ la recherche de son Nord intÃ©rieur",
      exercise: `
        <h2>IkigaÃ¯ â€“ Ce que jâ€™aime & ce pour quoi je suis douÃ©</h2>
        <label>Ce que jâ€™aime (passions, plaisirs simples) :</label>
        <textarea data-key="c5-aime" placeholder="Ex. : Lire, bricoler, marcher, Ã©couter du jazz..."></textarea>

        <label>Ce pour quoi je suis douÃ© (talents, facilitÃ©s) :</label>
        <textarea data-key="c5-doue" placeholder="Ex. : Organiser, raconter, rÃ©parer, Ã©couter..."></textarea>
      `
    },
    {
      title: "Chapitre 6 â€“ RÃ©vÃ©ler le Super-HÃ©ros en Sommeil",
      exercise: `
        <h2>Mes 5 forces de caractÃ¨re</h2>
        <ol>
          <li><input type="text" data-key="c6-f1" placeholder="Ex. : CuriositÃ©" /></li>
          <li><input type="text" data-key="c6-f2" placeholder="Ex. : HonnÃªtetÃ©" /></li>
          <li><input type="text" data-key="c6-f3" placeholder="Ex. : Humour" /></li>
          <li><input type="text" data-key="c6-f4" placeholder="Ex. : Patience" /></li>
          <li><input type="text" data-key="c6-f5" placeholder="Ex. : CrÃ©ativitÃ©" /></li>
        </ol>
      `
    },
    {
      title: "Chapitre 7 â€“ Devenir lâ€™auteur de sa propre lÃ©gende",
      exercise: `
        <h2>Titre & quatriÃ¨me de couverture de mon Tome 2</h2>
        <label>Titre :</label>
        <input type="text" data-key="c7-titre" placeholder="Ex. : Les Chroniques dâ€™un BÃ¢tisseur de Seconde Vie" />

        <label>RÃ©sumÃ© (Ã  la 3e personne) :</label>
        <textarea data-key="c7-resume" placeholder="Ex. : AprÃ¨s 40 ans de carriÃ¨re, il dÃ©couvre que..."></textarea>
      `
    },
    {
      title: "Chapitre 8 â€“ Lâ€™HÃ©ritage que nous laissons au Monde",
      exercise: `
        <h2>Contribution â€“ Quâ€™est-ce que la vie attend de moi ?</h2>
        <label>IdÃ©es concrÃ¨tes pour transmettre ce que jâ€™ai de meilleur :</label>
        <textarea data-key="c8-contribution" placeholder="Ex. : Donner un cours dâ€™histoire locale, rÃ©parer des jouets, partager mon herbier..."></textarea>
      `
    },
    {
      title: "Chapitre 9 â€“ Ã‰couter les Murmures du Corps",
      exercise: `
        <h2>Scan corporel & posture ressource</h2>
        <label>Message de mon corps aujourdâ€™hui :</label>
        <textarea data-key="c9-corps" placeholder="Ex. : Tension dans les Ã©paules => je porte un poids mental..."></textarea>

        <label>Ma posture ressource (comment je me tiens quand je me sens alignÃ©) :</label>
        <textarea data-key="c9-posture" placeholder="Ex. : Dos droit, Ã©paules basses, regard ouvert..."></textarea>
      `
    },
    {
      title: "Chapitre 10 â€“ Tracer le Sentier dâ€™une Nouvelle Aube",
      exercise: `
        <h2>Ma semaine idÃ©ale (intentions souples)</h2>
        <label>Lundi :</label>
        <textarea data-key="c10-lundi" placeholder="Ex. : Matin â€“ lecture sur Rome / AprÃ¨s-midi â€“ bricolage"></textarea>

        <label>Mardi :</label>
        <textarea data-key="c10-mardi" placeholder="Ex. : Marche en forÃªt + appel Ã  un ami"></textarea>

        <label>Mercredi :</label>
        <textarea data-key="c10-mercredi" placeholder="Ex. : Atelier bois + temps avec petits-enfants"></textarea>

        <label>Jeudi :</label>
        <textarea data-key="c10-jeudi" placeholder="Ex. : Visite guidÃ©e au musÃ©e + jazz le soir"></textarea>

        <label>Vendredi :</label>
        <textarea data-key="c10-vendredi" placeholder="Ex. : Cours dâ€™histoire bÃ©nÃ©vole + apÃ©ro avec CÃ©cile"></textarea>

        <label>Samedi :</label>
        <textarea data-key="c10-samedi" placeholder="Ex. : MarchÃ© + jardinage + film en famille"></textarea>

        <label>Dimanche :</label>
        <textarea data-key="c10-dimanche" placeholder="Ex. : Rien de planifiÃ© â€“ improvisation & repos"></textarea>
      `
    }
  ];

  let current = 0;

  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('open');
  }

  function toggleTheme() {
    const theme = document.documentElement.getAttribute('data-theme');
    const newTheme = theme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
  }

  function renderSidebar() {
    const nav = document.getElementById('nav');
    nav.innerHTML = '';
    chapters.forEach((chap, i) => {
      const btn = document.createElement('button');
      btn.textContent = `${i + 1}. ${chap.title}`;
      if (localStorage.getItem(`done-${i}`)) btn.classList.add('done');
      btn.onclick = () => {
        current = i;
        render();
        if (window.innerWidth < 768) toggleSidebar();
      };
      nav.appendChild(btn);
    });
  }

  function render() {
    renderSidebar();
    const chap = chapters[current];
    document.getElementById('content').innerHTML = `
      <h2>${chap.title}</h2>
      ${chap.exercise}
      <button class="btn" onclick="markDone()">âœ… Jâ€™ai terminÃ© ce chapitre</button>
    `;
    loadAll();
    updateProgress();
  }

  function markDone() {
    saveAll();
    localStorage.setItem(`done-${current}`, 'true');
    renderSidebar();
    updateProgress();
  }

  function updateProgress() {
    const total = chapters.length;
    const done = [...Array(total).keys()].filter(i => localStorage.getItem(`done-${i}`)).length;
    const percent = Math.round((done / total) * 100);
    document.getElementById('progress').style.width = `${percent}%`;
  }

  function saveAll() {
    document.querySelectorAll('textarea, input[type="text"]').forEach(el => {
      if (el.dataset.key) localStorage.setItem(el.dataset.key, el.value);
    });
  }

  function loadAll() {
    document.querySelectorAll('textarea, input[type="text"]').forEach(el => {
      if (el.dataset.key) el.value = localStorage.getItem(el.dataset.key) || '';
    });
  }

  function downloadLog() {
    let log = `# Mon carnet â€“ La Retraite, une Seconde Vie\n\n`;
    log += `ExportÃ© le : ${new Date().toLocaleDateString()}\n\n`;
    chapters.forEach((chap, i) => {
      log += `## ${chap.title}\n\n`;
      const div = document.createElement('div');
      div.innerHTML = chap.exercise;
      div.querySelectorAll('textarea, input').forEach(el => {
        if (el.dataset.key) {
          const val = localStorage.getItem(el.dataset.key) || '';
          const label = el.previousElementSibling?.textContent || 'Note';
          log += `**${label}**\n${val}\n\n`;
        }
      });
    });
    const blob = new Blob([log], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'mon-carnet-retraite.md';
    a.click();
  }

  // Initialisation
  document.documentElement.setAttribute('data-theme', localStorage.getItem('theme') || 'light');
  render();
</script>
</body>
</html>
