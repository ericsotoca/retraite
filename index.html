<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>La Retraite, une Seconde Vie â€“ Carnet 2.0</title>
  <style>
    :root {
      --bg: #fdfdfd;
      --text: #333;
      --accent: #e67e22;
      --primary: #2c3e50;
      --border: #ccc;
      --success: #27ae60;
    }
    [data-theme="dark"] {
      --bg: #121212;
      --text: #f1f1f1;
      --border: #444;
      --primary: #ecf0f1;
      --accent: #f39c12;
    }
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--primary);
      color: white;
    }
    #sidebar {
      position: fixed;
      top: 0;
      left: -250px;
      width: 250px;
      height: 100%;
      background: var(--primary);
      color: white;
      transition: left 0.3s;
      padding: 1rem;
      overflow-y: auto;
    }
    #sidebar.open {
      left: 0;
    }
    #sidebar button {
      display: block;
      width: 100%;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      background: transparent;
      border: 1px solid var(--border);
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }
    #sidebar button.done {
      background: var(--success);
      border-color: var(--success);
    }
    main {
      margin-left: 0;
      padding: 1rem;
      transition: margin-left 0.3s;
    }
    @media (min-width: 768px) {
      #sidebar {
        left: 0;
      }
      main {
        margin-left: 250px;
      }
    }
    .progress-bar {
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0;
    }
    .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.3s;
    }
    textarea, input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--bg);
      color: var(--text);
    }
    .hidden {
      display: none;
    }
    .suggestions {
      font-size: 0.9rem;
      color: var(--accent);
      cursor: pointer;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>

<header>
  <button onclick="toggleSidebar()">â˜°</button>
  <h1>Mon Carnet de Seconde Vie</h1>
  <button onclick="toggleTheme()">ðŸŒ—</button>
</header>

<aside id="sidebar"></aside>

<main id="content"></main>

<footer>
  <button onclick="downloadLog()">ðŸ“¥ TÃ©lÃ©charger mon carnet</button>
</footer>

<script>
  const chapters = [
    {
      title: "Chapitre 1 â€“ Le Grand Vide ou le Champ des Possibles ?",
      exercise: `
        <h2>Journal de Bord â€“ Cartographier le Point de DÃ©part</h2>
        <label>1. Ma MÃ©tÃ©o IntÃ©rieure :</label>
        <div class="suggestions" onclick="insert(this)">ðŸ’¡ Ex: "Je me sens perdu, mais curieux"</div>
        <textarea data-key="jour1-meteo" rows="3"></textarea>

        <label>2. Le Poids du PassÃ© :</label>
        <div class="suggestions" onclick="insert(this)">ðŸ’¡ Ex: "Jâ€™ai manquÃ© de mes collÃ¨gues"</div>
        <textarea data-key="jour1-passe" rows="3"></textarea>

        <label>3. La LÃ©gÃ¨retÃ© du PrÃ©sent :</label>
        <div class="suggestions" onclick="insert(this)">ðŸ’¡ Ex: "Je ne regrette pas les rÃ©unions"</div>
        <textarea data-key="jour1-present" rows="3"></textarea>
      `
    },
    {
      title: "Chapitre 2 â€“ Dire au revoir pour mieux se retrouver",
      exercise: `
        <h2>Lettre de Transition</h2>
        <label>Gratitude :</label>
        <textarea data-key="lettre-gratitude" rows="4"></textarea>
        <label>Griefs :</label>
        <textarea data-key="lettre-griefs" rows="4"></textarea>
        <label>Adieu :</label>
        <textarea data-key="lettre-adieu" rows="4"></textarea>
      `
    },
    // ... tu peux ajouter les autres chapitres ici de la mÃªme maniÃ¨re
  ];

  let current = 0;

  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('open');
  }

  function toggleTheme() {
    const theme = document.documentElement.getAttribute('data-theme');
    document.documentElement.setAttribute('data-theme', theme === 'dark' ? 'light' : 'dark');
    localStorage.setItem('theme', theme === 'dark' ? 'light' : 'dark');
  }

  function insert(el) {
    const textarea = el.nextElementSibling;
    textarea.value = el.textContent.replace('ðŸ’¡ Ex: ', '');
    saveAll();
  }

  function renderSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.innerHTML = '';
    chapters.forEach((chap, i) => {
      const btn = document.createElement('button');
      btn.textContent = `${i + 1}. ${chap.title}`;
      if (localStorage.getItem(`done-${i}`)) btn.classList.add('done');
      btn.onclick = () => {
        current = i;
        render();
        if (window.innerWidth < 768) toggleSidebar();
      };
      sidebar.appendChild(btn);
    });
  }

  function render() {
    renderSidebar();
    const chap = chapters[current];
    document.getElementById('content').innerHTML = `
      <h2>${chap.title}</h2>
      ${chap.exercise}
      <button class="save" onclick="markDone()">âœ… Jâ€™ai terminÃ© ce chapitre</button>
    `;
    loadAll();
    updateProgress();
  }

  function markDone() {
    saveAll();
    localStorage.setItem(`done-${current}`, 'true');
    renderSidebar();
    updateProgress();
  }

  function updateProgress() {
    const total = chapters.length;
    const done = [...Array(total).keys()].filter(i => localStorage.getItem(`done-${i}`)).length;
    const percent = Math.round((done / total) * 100);
    const bar = document.querySelector('.progress-fill');
    if (bar) bar.style.width = `${percent}%`;
  }

  function saveAll() {
    document.querySelectorAll('textarea, input[type="text"]').forEach(el => {
      if (el.dataset.key) localStorage.setItem(el.dataset.key, el.value);
    });
  }

  function loadAll() {
    document.querySelectorAll('textarea, input[type="text"]').forEach(el => {
      if (el.dataset.key) el.value = localStorage.getItem(el.dataset.key) || '';
    });
  }

  function downloadLog() {
    let log = `# Mon carnet â€“ La Retraite, une Seconde Vie\nDate d'export : ${new Date().toLocaleDateString()}\n\n`;
    chapters.forEach((chap, i) => {
      log += `## ${chap.title}\n`;
      const div = document.createElement('div');
      div.innerHTML = chap.exercise;
      div.querySelectorAll('textarea, input').forEach(el => {
        if (el.dataset.key) {
          const val = localStorage.getItem(el.dataset.key) || '';
          log += `**${el.previousElementSibling?.textContent || 'Note'}** : ${val}\n\n`;
        }
      });
    });
    const blob = new Blob([log], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'mon-carnet-retraite.md';
    a.click();
  }

  // Initialisation
  document.documentElement.setAttribute('data-theme', localStorage.getItem('theme') || 'light');
  render();
</script>
</body>
</html>
